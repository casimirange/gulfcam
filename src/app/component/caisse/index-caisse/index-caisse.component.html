
<div class="app-page-title">
  <div class="page-title-wrapper">
    <div class="page-title-heading">
      <div class="page-title-icon">
        <i class="pe-7s-news-paper icon-gradient bg-night-fade">
        </i>
      </div>
      <div>Gestion de la caisse
        <div class="page-title-subheading">Enregistrez et gérez le suivi des commandes</div>
      </div>
    </div>
<!--    <div class="page-title-actions">-->
<!--      <div class="d-inline-block ">-->
<!--        <button (click)="openCommandModal(orderModal)" type="button" data-toggle="tooltip" title="nouvelle commande" class="btn-shadow btn btn-primary">-->
<!--                                        <span class="btn-icon-wrapper pr-2 opacity-7">-->
<!--                                            <i class="fa fa-plus fa-w-20"></i>-->
<!--                                        </span>-->
<!--          Commande-->
<!--        </button>-->
<!--      </div>-->
<!--    </div>-->
  </div>
</div>
<!--  <ul class="body-tabs body-tabs-layout tabs-animated body-tabs-animated nav">-->
<!--    <li class="nav-item">-->
<!--      <div class="search-wrapper" [ngClass]="displaySearchBar? 'active' : ''">-->
<!--        <div class="input-holder">-->
<!--          <input type="text" class="search-input" placeholder="Rechercher client">-->
<!--          <button class="search-icon" (click)="!displaySearchBar ? searchBar() : findClient()"><span></span></button>-->
<!--        </div>-->
<!--        <button class="close"(click)="searchBar()"></button>-->
<!--      </div>-->
<!--    </li>-->
<!--  </ul>-->
<!-- si le client est trouvé on affiche ses informations-->
<!--  <div class="tab-content">-->
<!--    <div class="tab-pane tabs-animation fade show active" id="tab-content-0" role="tabpanel">-->
<!--      <div class="main-card mb-3 card">-->
<!--        <div class="card-body">-->
<!--          <div class="card-title">Résultat de la recherche</div>-->
<!--          &lt;!&ndash;          si la recherche n'est pas trouvée&ndash;&gt;-->
<!--          <ng-template>-->
<!--            <div class="text-center">-->
<!--              <p>Oups... Désolé ce client n'est pas encore enregistré</p>-->
<!--            </div>-->
<!--          </ng-template>-->

<!--          &lt;!&ndash;          si la recherche est trouvée&ndash;&gt;-->
<!--          <ng-template></ng-template>-->

<!--          <p>With supporting text below as a natural lead-in to additional content.</p>-->
<!--          <p class="mb-0">Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled.</p></div>-->
<!--        <div class="d-block text-right card-footer">-->
<!--          <button class="mr-2 btn btn-link btn-sm">Cancel</button>-->
<!--          <button class="btn btn-success btn-lg" (click)="openCommandModal(clientModal)">Save</button>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->
<!--  </div>-->

<div class="row">
  <div class="col-md-12">
    <div class="main-card mb-3 card " id="htmlData">
      <div class="card-header">
        Liste des commandes
        <!--          <div class="btn-actions-pane-right">-->
        <!--            <div role="group" class="btn-group-sm btn-group">-->
        <!--              &lt;!&ndash;<button routerLink="/new-panne" class="btn btn-primary" [swal]="deleteSwals">Nouvelle Panne</button>&ndash;&gt;-->
        <!--              <form >-->
        <!--                <input type="text" placeholder="Ref. commande" class="form-control form-control-sm" formControlName="search">-->
        <!--                <input type="text" placeholder="Ref. client" class="form-control form-control-sm" formControlName="search">-->
        <!--                <input type="text" placeholder="Nom client" class="form-control form-control-sm" formControlName="search">-->
        <!--                <input type="text" placeholder="Date commande" class="form-control form-control-sm" formControlName="search">-->
        <!--              </form>-->
        <!--            </div>-->
        <!--          </div>-->

        <div class="btn-actions-pane-right">
          <div role="group" class="btn-group-sm">
            <div >
              <!--                <form >-->
              <!--                  <div class="form-row">-->

              <!--                    <div class="col-md-2">-->
              <!--                      <input type="text" placeholder="Ref. commande" class="form-control form-control-sm" formControlName="date1">-->
              <!--                    </div>-->
              <!--                    <div class="col-md-2">-->
              <!--                      <input type="text" placeholder="Ref.lcient" class="form-control form-control-sm" formControlName="date2">-->
              <!--                    </div>-->
              <!--                    <div class="col-md-2">-->
              <!--                      <input type="text" placeholder="Nom client" class="form-control form-control-sm" formControlName="date2">-->
              <!--                    </div>-->
              <!--                    <div class="col-md-2">-->
              <!--                      <input type="date" placeholder="Electricien" class="form-control form-control-sm" formControlName="date2">-->
              <!--                    </div>-->
              <!--                    <div class="col-md-2">-->
              <!--                      <button class="btn-transition btn btn-sm btn-shadow btn-outline-primary form-control-sm form-control" type="submit"><i class="fa fa-search"></i></button>-->

              <!--                    </div>-->

              <!--                  </div>-->
              <!--                </form>-->
            </div>
          </div>
        </div>
      </div>

      <div class="table-responsive" >
        <table class="align-middle mb-0 table table-sm table-borderless table-hover" id="element-pannes">
          <thead>
          <tr>
            <th class="">Ref#</th>
            <th class="">Date</th>
            <th class="">Client</th>
            <!--              <th class="">Quantité</th>-->
            <!--              <th class="">Type de coupon</th>-->
            <th class="">Magasin</th>
            <th class="">Statut</th>
            <!--<th class="text-center">Actions</th>-->
          </tr>
          </thead>
          <tbody>
          <tr style="cursor: pointer" routerLink="/commandes/edit/{{order.internalReference}}" *ngFor="let order of orders">
            <td class="text-left">{{order.internalReference}}</td>
            <td class="text-left">{{order.createdAt | date: 'dd/MM/yyyy'}}</td>
            <td class="text-left"><span *ngFor="let cli of clients">{{cli.internalReference == order.idClient ? cli.completeName : ''}}</span></td>
            <!--              <td class="text-left">12</td>-->
            <!--              <td class="text-left" > type 1 </td>-->
            <td class="text-left" ><span *ngFor="let store of stores">{{store.internalReference == order.idStore ? store.localization : ''}}</span></td>
            <td class="text-left" > <span class="text-focus">{{order.status.name}}</span> </td>
          </tr>

          </tbody>

        </table>
        <!--          dans le cas où aucune commande n'est trouvée-->
        <ng-template>
          <p style="color: grey; font-size: 1.8rem;" class="text-center" >Aucune commande trouvée !</p>
        </ng-template>
      </div>
    </div>
  </div>
</div>

<!--formulaire création commande-->
<ng-template #orderModal let-modal>
  <div class="modal-header">
    <h6 class="modal-title timeline-title" id="modal-basic-titles"><b>{{title}}</b> </h6>
    <div class="close vertical-timeline-element-content bounce-in" (click)=" modal.close('save click')" >
      <!--      <span class="timeline-title"><b>machine</b></span>-->
      <p><i class="fa fa-times"></i></p>
    </div>
  </div>
  <div class="modal-body" *ngIf="!showClientForm">
    <div class="">
      <div class="">
        <form [formGroup]="orderForm">
          <div class="row">
            <div class="col-md-6">
              <div class="card">
                <div class="col-md-12">
                  <div class="row">
                    <div class="col-md-9">
                      <div class="position-relative form-group">
                        <label for="clientref" class="">Client *</label>
                        <input type="text" id="clientref" class="form-control" formControlName="client" placeholder="choisir un client" list="clientsListOption">
                        <datalist id="clientsListOption">
                          <option *ngFor="let client of clients" [value]="client.completeName"></option>
                        </datalist>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="position-relative form-group">
                        <label class="text-white">Client *</label>
                        <button (click)="showClientForms()" class="btn btn-primary">+ client</button>
                      </div>
                    </div>
                  </div>

                </div>

                <!--                  <div class="col-md-12">-->
                <!--                    <div class="position-relative form-group">-->
                <!--                      <label for="bc" class="">Bon de commande</label>-->
                <!--                      <input name="email" id="bc" placeholder="entrer le numéro du bon" type="text" class="form-control" formControlName="voucherNumber">-->
                <!--                    </div>-->
                <!--                  </div>-->

                <div class="col-md-12">
                  <div class="position-relative form-group">
                    <label for="canal" class="">Canal</label>
                    <select name="select" id="canal" class="form-control" formControlName="chanel">
                      <option>--Sélectionner un canal--</option>
                      <option *ngFor="let can of canaux">{{can}}</option>
                    </select>
                  </div>
                </div>
                <div class="col-md-12">
                  <div class="position-relative form-group">
                    <label for="tb" class="">Magasin</label>
                    <select name="select" id="tb" class="form-control" formControlName="store">
                      <option>--Sélectionner un magasin--</option>
                      <option *ngFor="let store of stores">{{store.localization}}</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="main-card card">
                <div class="card-body">
                  <div class="row col-md-12">
                    <div class="col-md-5">
                      <div class="position-relative form-group">
                        <label for="tb" class="">Type de coupon</label>
                        <select name="select" id="tb" class="form-control" formControlName="voucherType">
                          <option>--Sélectionner un coupon--</option>
                          <option *ngFor="let tVoucher of vouchers">{{tVoucher.amount}}</option>
                        </select>
                      </div>
                    </div>
                    <div class="col-md-5">
                      <div class="position-relative form-group">
                        <label for="qte" class="">Quantité *</label>
                        <input name="email" id="qte" placeholder="entrer une quantité" type="text" class="form-control" formControlName="quantity">
                      </div>
                    </div>
                    <div class="col-md-2">
                      <div class="position-relative form-group">
                        <label for="add" class="text-white">ajouter</label>
                        <button id="add" class=" btn btn-primary float-right"
                                [disabled]="orderForm.controls['quantity'].invalid && orderForm.controls['voucherType'].invalid"
                                (click)="addProduct()">+</button>
                      </div>
                    </div>
                  </div>
                  <h5 class="card-title">Liste des coupons</h5>
                  <table class="mb-0 table table-sm">
                    <thead>
                    <tr>
                      <th>#</th>
                      <th>Type de bon</th>
                      <th>Quantité</th>
                      <th>Total</th>
                      <th></th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr *ngFor="let prod of tabProducts; let i = index">
                      <th scope="row">{{i + 1}}</th>
                      <td>{{prod.voucher}}</td>
                      <td>{{prod.quantity}}</td>
                      <td>{{prod.total}}</td>
                      <td><i class="pe-7s-trash text-danger" (click)="removeProduct(prod)"></i></td>
                    </tr>
                    </tbody>
                    <tfoot>
                    <div class="float-right">Total: {{totalOrder}} Fcfa</div>
                    </tfoot>
                  </table>
                  <p *ngIf="tabProducts.length == 0" class="text-focus text-center">Ajouter des produits à la commande</p>
                </div>
              </div>
            </div>
          </div>
          <button class="mt-1 btn btn-primary float-right" (click)="saveOrder()"
                  [disabled]="tabProducts.length == 0 && orderForm.controls['client'].invalid && orderForm.controls['store'].invalid && orderForm.controls['chanel'].invalid "
          >Enregistrer</button>
        </form>
      </div>
    </div>
  </div>

  <div class="modal-body" *ngIf="showClientForm">
    <div class="">
      <div class="">
        <form [formGroup]="clientForm">
          <div class="row">
            <div class="col-md-6">
              <div class="position-relative form-group">
                <label for="email" class="">Email</label>
                <input name="email" id="email" placeholder="email"  type="email" class="form-control" formControlName="email">
              </div>
              <div *ngIf="clientForm.controls['email'].invalid && (clientForm.controls['email'].dirty || clientForm.controls['email'].touched)"
                   class="mb-2"  style="color: #f65656; font-style: italic;">

                <div *ngIf="clientForm.controls['email'].errors?.['required']" class="ml-3">
                  l'email est obligatoire.
                </div>
                <div *ngIf="clientForm.controls['email'].errors?.['email']" class="ml-3">
                  entrez une email valide : example@example.com
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="position-relative form-group">
                <label for="name" class="">Nom complet</label>
                <input name="completeName" id="name" placeholder="email" type="text" class="form-control" formControlName="completeName">
              </div>
              <div *ngIf="clientForm.controls['completeName'].invalid && (clientForm.controls['completeName'].dirty || clientForm.controls['completeName'].touched)"
                   class="mb-2"  style="color: #f65656; font-style: italic;">

                <div *ngIf="clientForm.controls['completeName'].errors?.['required']" class="ml-3">
                  le nom est obligatoire.
                </div>
                <div *ngIf="clientForm.controls['completeName'].errors?.['minLength']" class="ml-3">
                  entrez un nom valide : example@example.com
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6">
              <div class="position-relative form-group">
                <label for="reason" class="">Raison sociale</label>
                <input name="email" id="reason" placeholder="nom société" type="text" class="form-control" formControlName="companyName">
              </div>
              <div *ngIf="clientForm.controls['companyName'].invalid && (clientForm.controls['companyName'].dirty || clientForm.controls['companyName'].touched)"
                   class="mb-2"  style="color: #f65656; font-style: italic;">

                <div *ngIf="clientForm.controls['companyName'].errors?.['required']" class="ml-3">
                  le nom de la compagnie est obligatoire.
                </div>
                <div *ngIf="clientForm.controls['companyName'].errors?.['minLength']" class="ml-3">
                  entrez un nom de compagnie valide
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="position-relative form-group">
                <label for="address" class="">Adresse</label>
                <input name="email" id="address" placeholder="adresse" type="text" class="form-control" formControlName="address">
              </div>
              <div *ngIf="clientForm.controls['address'].invalid && (clientForm.controls['address'].dirty || clientForm.controls['address'].touched)"
                   class="mb-2"  style="color: #f65656; font-style: italic;">

                <div *ngIf="clientForm.controls['address'].errors?.['required']" class="ml-3">
                  l'adresse est obligatoire.
                </div>
                <div *ngIf="clientForm.controls['address'].errors?.['minLength']" class="ml-3">
                  entrez une adresse valide
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6">
              <div class="position-relative form-group">
                <label for="phone" class="">Numéro de téléphone</label>
                <input name="email" id="phone" placeholder="with a placeholder" type="text" class="form-control" formControlName="phone">
              </div>
              <div *ngIf="clientForm.controls['phone'].invalid && (clientForm.controls['phone'].dirty || clientForm.controls['phone'].touched)"
                   class="mb-2"  style="color: #f65656; font-style: italic;">

                <div *ngIf="clientForm.controls['phone'].errors?.['required']" class="ml-3">
                  le numéro de téléphone est obligatoire.
                </div>
                <div *ngIf="clientForm.controls['phone'].errors?.['pattern']" class="ml-3">
                  Le numéro de téléphone doit comporter 9 chiffres commençant par 2 ou 6
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="position-relative form-group">
                <label for="rccm" class="">RCCM</label>
                <input name="email" id="rccm" placeholder="RCCM" type="text" class="form-control" formControlName="rccm">
              </div>
              <div *ngIf="clientForm.controls['rccm'].invalid && (clientForm.controls['rccm'].dirty || clientForm.controls['rccm'].touched)"
                   class="mb-2"  style="color: #f65656; font-style: italic;">

                <div *ngIf="clientForm.controls['rccm'].errors?.['required']" class="ml-3">
                  le numéro de téléphone est obligatoire.
                </div>
                <div *ngIf="clientForm.controls['rccm'].errors?.['pattern']" class="ml-3">
                  Le numéro de téléphone doit comporter 9 chiffres commençant par 2 ou 6
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6">
              <div class="position-relative form-group">
                <label for="comptnumber" class="">Numéro de compte Gulfcam</label>
                <input name="email" id="comptnumber" placeholder="Numéro de compte" type="text" class="form-control" formControlName="gulfcamAccountNumber">
              </div>
              <div *ngIf="clientForm.controls['gulfcamAccountNumber'].invalid && (clientForm.controls['gulfcamAccountNumber'].dirty || clientForm.controls['gulfcamAccountNumber'].touched)"
                   class="mb-2"  style="color: #f65656; font-style: italic;">

                <div *ngIf="clientForm.controls['gulfcamAccountNumber'].errors?.['required']" class="ml-3">
                  le numéro de téléphone est obligatoire.
                </div>
                <div *ngIf="clientForm.controls['gulfcamAccountNumber'].errors?.['pattern']" class="ml-3">
                  Le numéro de téléphone doit comporter 9 chiffres commençant par 2 ou 6
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="position-relative form-group">
                <label for="typeClient" class="">Type de client</label>
                <select name="select" id="typeClient" class="form-control" formControlName="typeClient">
                  <option>--Sélectionner un type--</option>
                  <option value="ENTREPRISE">Entreprise</option>
                  <option value="INSTITUTION">Institution</option>
                  <option value="PARTICULAR">Particulier</option>
                </select>

              </div>
              <div *ngIf="clientForm.controls['typeClient'].invalid && (clientForm.controls['typeClient'].dirty || clientForm.controls['typeClient'].touched)"
                   class="mb-2"  style="color: #f65656; font-style: italic;">

                <div *ngIf="clientForm.controls['typeClient'].errors?.['required']" class="ml-3">
                  le type de client est obligatoire.
                </div>
                <!--                <div *ngIf="clientForm.controls['typeClient'].errors?.['pattern']" class="ml-3">-->
                <!--                  Le numéro de téléphone doit comporter 9 chiffres commençant par 2 ou 6-->
                <!--                </div>-->
              </div>
            </div>
          </div>
          <button class="mt-1 btn btn-primary float-right ml-3" (click)="saveClientt()">Enregistrer client</button>
          <button class="mt-1 btn btn-secondary float-right"><i class="pe-7s-back"></i>Annuler</button>
        </form>
      </div>
    </div>
  </div>
</ng-template>
